FROM bitnami/kafka:2.8

# Install netcat for the Kafka readiness check
USER root
RUN apt-get update && apt-get install -y netcat && rm -rf /var/lib/apt/lists/*

# Copy the topic creation script into a directory where we have permissions
COPY create-topics.sh /usr/local/bin/

# Set ownership and permissions for the script
RUN chown root:root /usr/local/bin/create-topics.sh && chmod +x /usr/local/bin/create-topics.sh

# Set the entrypoint to run the topic creation script and then start Kafka
ENTRYPOINT ["/usr/local/bin/create-topics.sh"]
